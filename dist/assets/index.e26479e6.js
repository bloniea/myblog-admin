import{b as te,h as ae,i as oe,j as se,k as le}from"./fetch.78d37eeb.js";/* empty css                   *//* empty css                       *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                           *//* empty css                   *//* empty css                  */import{i as x,X as ne,j as f,Y as re,Z as de,m as ie,A as ce,_ as ue,a0 as pe,a1 as me,a2 as _e,B as fe,D as ge,F as he,a9 as be,G as ye,o as z,I as ke,a as t,w as s,u as o,W as R,a5 as Ce,H as N,c as L,K as c,L as we,a6 as ve,a7 as Ve,J as M,aa as j,R as i,a8 as Ee}from"./vendor.3ed8f5cd.js";import{s as xe}from"./functions.4004cecb.js";import"./index.ff990c46.js";const ze={class:"roles"},Re=c("\u9996\u9875"),Ae=c("\u89D2\u8272\u7BA1\u7406"),Be=c("\u89D2\u8272\u5217\u8868"),Fe=c("\u6DFB\u52A0\u89D2\u8272"),Ke=c("\u4FEE\u6539"),Te=c("\u5220\u9664"),De={class:"dialog-footer"},Ie=c("\u53D6 \u6D88"),Se=c("\u786E \u5B9A"),Ue={class:"dialog-footer"},$e=c("\u53D6 \u6D88"),Ne=c("\u786E \u5B9A"),Qe={setup(Le){const v=x(!0),{proxy:k}=ne(),p=f({keyword:"",pagenum:1,pagesize:10}),r=f({edit:!1,btn:!1}),g=f({list:[],total:0,pagesizes:[1,5,10,20]}),m=async()=>{v.value=!0;const a=await te(p);a.ok&&a.status===200&&(g.total=a.data.total,g.list=a.data.data,v.value=!1)};m();const h=x(!1),H=()=>{h.value=!0},A=f({name:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",trigger:"blur"},{min:2,max:8,message:"\u957F\u5EA6\u5728 2 \u5230 8 \u4E2A\u5B57\u7B26",trigger:"blur"}]}),C=f({name:""}),B=()=>{k.$refs.addFrom.validate(async a=>{if(a){r.btn=!0;const e=await ae(C);if(e.ok&&e.status===200)i.success("\u6DFB\u52A0\u6210\u529F"),k.$refs.addFrom.resetFields(),h.value=!1,r.btn=!1,m();else return r.btn=!1,i.error(e.data.message)}})},F=()=>{k.$refs.addFrom.resetFields(),h.value=!1},P=async a=>{Ee.confirm("\u786E\u8BA4\u5220\u9664\u89D2\u8272\uFF1F","\u8B66\u544A",{distinguishCancelAndClose:!0,confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88"}).then(async()=>{i({dangerouslyUseHTMLString:!0,message:"\u6B63\u5728\u5220\u9664\u4E2D",type:"warning",duration:0});const e=await oe(a);e.ok&&e.status===200?(i.closeAll(),i.success("\u5220\u9664\u6210\u529F"),m()):(i.closeAll(),i.error(e.data.message))}).catch(()=>{i.closeAll()})},K=()=>{m()},q=a=>{p.pagesize=a,m()},G=a=>{p.pagenum=a,m()},b=x(!1),_=f({}),u=f({list:[],roleId:0,treeProps:{label:"name",children:"children"},defaultCheckedkeys:[]}),T=()=>{b.value=!1},J=async a=>{b.value=!0,r.edit=!0,u.defaultCheckedkeys=[],u.roleId=a._id,_.name=a.name,_.pers=a.pers;const e=await se();if(e.status!==200)return i.error(e.data.message);u.list=e.data.data;const l=D(e.data.data,[]),y=a.pers?a.pers.split(","):[];u.defaultCheckedkeys=X(l,y),r.edit=!1},W=(a,e)=>{const l=[...e.checkedKeys,...e.halfCheckedKeys];_.pers=l.toString()},D=(a,e)=>(a.forEach(l=>{l.children?D(l.children,e):e.push(l.per_name)}),e),X=(a,e)=>{const l=[];return a.forEach(y=>{e.forEach(d=>{y===d&&l.push(d)})}),l},I=()=>{k.$refs.editFrom.validate(async a=>{if(a){r.btn=!0;const e=await le(u.roleId,_);if(e.ok&&e.status===200)i.success("\u4FEE\u6539\u6210\u529F"),m(),b.value=!1,r.btn=!1;else return r.btn=!1,i.error(e.data.message)}})};return(a,e)=>{const l=re,y=de,d=ie,V=ce,w=ue,Y=pe,Z=me,O=_e,E=fe,S=ge,U=he,Q=be,$=ye;return z(),ke("div",ze,[t(y,{"separator-class":"el-icon-arrow-right"},{default:s(()=>[t(l,{to:{name:"Home"}},{default:s(()=>[Re]),_:1}),t(l,null,{default:s(()=>[Ae]),_:1}),t(l,null,{default:s(()=>[Be]),_:1})]),_:1}),t(O,null,{default:s(()=>[t(V,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",class:"input-with-select",modelValue:o(p).keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>o(p).keyword=n),onKeyup:R(K,["enter"])},{append:s(()=>[t(d,{icon:o(Ce),onClick:K},null,8,["icon"])]),_:1},8,["modelValue","onKeyup"]),t(d,{type:"primary",class:"add",onClick:H},{default:s(()=>[Fe]),_:1}),N((z(),L(Y,{data:o(g).list,border:"",style:{width:"100%"}},{default:s(()=>[t(w,{label:"#",type:"index"}),t(w,{prop:"name",label:"\u89D2\u8272"}),t(w,{prop:"created_at",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(n=>[c(we(o(xe)(n.row.created_at)),1)]),_:1}),t(w,{label:"\u64CD\u4F5C"},{default:s(n=>[t(d,{type:"primary",icon:o(ve),onClick:ee=>J(n.row),size:"small"},{default:s(()=>[Ke]),_:2},1032,["icon","onClick"]),t(d,{type:"danger",icon:o(Ve),onClick:ee=>P(n.row._id),size:"small"},{default:s(()=>[Te]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[$,v.value]]),t(Z,{onSizeChange:q,onCurrentChange:G,"current-page":o(p).pagenum,"page-sizes":o(g).pagesizes,"page-size":o(p).pagesize,layout:"total, sizes, prev, pager, next, jumper",total:o(g).total},null,8,["current-page","page-sizes","page-size","total"])]),_:1}),t(U,{title:"\u6DFB\u52A0\u89D2\u8272",modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=n=>h.value=n),width:"30%",onClose:F},{footer:s(()=>[M("span",De,[t(d,{onClick:F},{default:s(()=>[Ie]),_:1}),t(d,{onClick:B,type:"primary",loading:o(r).btn},{default:s(()=>[Se]),_:1},8,["loading"])])]),default:s(()=>[t(S,{ref:"addFrom",model:o(C),"label-width":"80px",rules:o(A),onSubmit:e[2]||(e[2]=j(()=>{},["prevent"]))},{default:s(()=>[t(E,{label:"\u89D2\u8272",prop:"name"},{default:s(()=>[t(V,{modelValue:o(C).name,"onUpdate:modelValue":e[1]||(e[1]=n=>o(C).name=n),onKeyup:R(B,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(U,{title:"\u4FEE\u6539\u89D2\u8272",modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=n=>b.value=n),width:"50%",onClose:T},{footer:s(()=>[M("span",Ue,[t(d,{onClick:T},{default:s(()=>[$e]),_:1}),t(d,{onClick:I,type:"primary",loading:o(r).btn,disabled:o(r).edit},{default:s(()=>[Ne]),_:1},8,["loading","disabled"])])]),default:s(()=>[N((z(),L(S,{ref:"editFrom",model:o(_),"label-width":"80px",rules:o(A),onSubmit:e[5]||(e[5]=j(()=>{},["prevent"]))},{default:s(()=>[t(E,{label:"\u89D2\u8272",prop:"name"},{default:s(()=>[t(V,{modelValue:o(_).name,"onUpdate:modelValue":e[4]||(e[4]=n=>o(_).name=n),onKeyup:R(I,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(E,null,{default:s(()=>[t(Q,{data:o(u).list,"show-checkbox":"","node-key":"per_name","default-checked-keys":o(u).defaultCheckedkeys,props:o(u).treeProps,onCheck:W},null,8,["data","default-checked-keys","props"])]),_:1})]),_:1},8,["model","rules"])),[[$,o(r).edit]])]),_:1},8,["modelValue"])])}}};export{Qe as default};
