import{b as te,h as ae,i as oe,j as se,k as le}from"./fetch.ddd67e48.js";/* empty css                   *//* empty css                       *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                           *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                   */import{i as x,X as ne,j as f,Y as re,Z as de,m as ie,A as ce,_ as ue,a0 as pe,a1 as me,a2 as _e,B as fe,D as ge,F as he,a9 as be,G as ye,o as z,I as ke,a,w as s,u as o,W as R,a5 as Ce,H as U,c as N,K as c,L as we,a6 as ve,a7 as Ve,J as L,aa as M,R as i,a8 as Ee}from"./vendor.9ce32bbf.js";import{s as xe}from"./functions.4004cecb.js";import"./index.83ef3299.js";const ze={class:"roles"},Re=c("\u9996\u9875"),Be=c("\u89D2\u8272\u7BA1\u7406"),Ae=c("\u89D2\u8272\u5217\u8868"),Fe=c("\u6DFB\u52A0\u89D2\u8272"),Ke=c("\u4FEE\u6539"),Te=c("\u5220\u9664"),De={class:"dialog-footer"},Ie=c("\u53D6 \u6D88"),Se=c("\u786E \u5B9A"),$e={class:"dialog-footer"},Ue=c("\u53D6 \u6D88"),Ne=c("\u786E \u5B9A"),tt={setup(Le){const v=x(!0),{proxy:k}=ne(),p=f({keyword:"",pagenum:1,pagesize:10}),r=f({edit:!1,btn:!1}),g=f({list:[],total:0,pagesizes:[1,5,10,20]}),u=async()=>{v.value=!0;const t=await te(p);t.ok&&t.status===200&&(g.total=t.data.total,g.list=t.data.data,v.value=!1)};u();const j=t=>{t==""&&u()},h=x(!1),H=()=>{h.value=!0},B=f({name:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",trigger:"blur"},{min:2,max:8,message:"\u957F\u5EA6\u5728 2 \u5230 8 \u4E2A\u5B57\u7B26",trigger:"blur"}]}),C=f({name:""}),A=()=>{k.$refs.addFrom.validate(async t=>{if(t){r.btn=!0;const e=await ae(C);if(e.ok&&e.status===200)i.success("\u6DFB\u52A0\u6210\u529F"),k.$refs.addFrom.resetFields(),h.value=!1,r.btn=!1,u();else return r.btn=!1,i.error(e.data.message)}})},F=()=>{k.$refs.addFrom.resetFields(),h.value=!1},P=async t=>{Ee.confirm("\u786E\u8BA4\u5220\u9664\u89D2\u8272\uFF1F","\u8B66\u544A",{distinguishCancelAndClose:!0,confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88"}).then(async()=>{i({dangerouslyUseHTMLString:!0,message:"\u6B63\u5728\u5220\u9664\u4E2D",type:"warning",duration:0});const e=await oe(t);e.ok&&e.status===200?(i.closeAll(),i.success("\u5220\u9664\u6210\u529F"),u()):(i.closeAll(),i.error(e.data.message))}).catch(()=>{i.closeAll()})},q=t=>{p.pagesize=t,u()},G=t=>{p.pagenum=t,u()},b=x(!1),_=f({}),m=f({list:[],roleId:0,treeProps:{label:"name",children:"children"},defaultCheckedkeys:[]}),K=()=>{b.value=!1},J=async t=>{b.value=!0,r.edit=!0,m.defaultCheckedkeys=[],m.roleId=t._id,_.name=t.name,_.pers=t.pers;const e=await se();if(e.status!==200)return i.error(e.data.message);m.list=e.data.data;const n=T(e.data.data,[]),y=t.pers?t.pers.split(","):[];m.defaultCheckedkeys=X(n,y),r.edit=!1},W=(t,e)=>{const n=[...e.checkedKeys,...e.halfCheckedKeys];_.pers=n.toString()},T=(t,e)=>(t.forEach(n=>{n.children?T(n.children,e):e.push(n.per_name)}),e),X=(t,e)=>{const n=[];return t.forEach(y=>{e.forEach(d=>{y===d&&n.push(d)})}),n},D=()=>{k.$refs.editFrom.validate(async t=>{if(t){r.btn=!0;const e=await le(m.roleId,_);if(e.ok&&e.status===200)i.success("\u4FEE\u6539\u6210\u529F"),u(),b.value=!1,r.btn=!1;else return r.btn=!1,i.error(e.data.message)}})};return(t,e)=>{const n=re,y=de,d=ie,V=ce,w=ue,Y=pe,Z=me,O=_e,E=fe,I=ge,S=he,Q=be,$=ye;return z(),ke("div",ze,[a(y,{"separator-class":"el-icon-arrow-right"},{default:s(()=>[a(n,{to:{name:"Home"}},{default:s(()=>[Re]),_:1}),a(n,null,{default:s(()=>[Be]),_:1}),a(n,null,{default:s(()=>[Ae]),_:1})]),_:1}),a(O,null,{default:s(()=>[a(V,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",class:"input-with-select",modelValue:o(p).keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>o(p).keyword=l),onKeyup:R(u,["enter"]),onBlur:e[1]||(e[1]=l=>j(o(p).keyword)),clearable:"",onClear:u},{append:s(()=>[a(d,{icon:o(Ce),onClick:u},null,8,["icon"])]),_:1},8,["modelValue","onKeyup"]),a(d,{type:"primary",class:"add",onClick:H},{default:s(()=>[Fe]),_:1}),U((z(),N(Y,{data:o(g).list,border:"",style:{width:"100%"}},{default:s(()=>[a(w,{label:"#",type:"index"}),a(w,{prop:"name",label:"\u89D2\u8272"}),a(w,{prop:"created_at",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(l=>[c(we(o(xe)(l.row.created_at)),1)]),_:1}),a(w,{label:"\u64CD\u4F5C"},{default:s(l=>[a(d,{type:"primary",icon:o(ve),onClick:ee=>J(l.row),size:"small"},{default:s(()=>[Ke]),_:2},1032,["icon","onClick"]),a(d,{type:"danger",icon:o(Ve),onClick:ee=>P(l.row._id),size:"small"},{default:s(()=>[Te]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[$,v.value]]),a(Z,{onSizeChange:q,onCurrentChange:G,"current-page":o(p).pagenum,"page-sizes":o(g).pagesizes,"page-size":o(p).pagesize,layout:"total, sizes, prev, pager, next, jumper",total:o(g).total},null,8,["current-page","page-sizes","page-size","total"])]),_:1}),a(S,{title:"\u6DFB\u52A0\u89D2\u8272",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),width:"30%",onClose:F},{footer:s(()=>[L("span",De,[a(d,{onClick:F},{default:s(()=>[Ie]),_:1}),a(d,{onClick:A,type:"primary",loading:o(r).btn},{default:s(()=>[Se]),_:1},8,["loading"])])]),default:s(()=>[a(I,{ref:"addFrom",model:o(C),"label-width":"80px",rules:o(B),onSubmit:e[3]||(e[3]=M(()=>{},["prevent"]))},{default:s(()=>[a(E,{label:"\u89D2\u8272",prop:"name"},{default:s(()=>[a(V,{modelValue:o(C).name,"onUpdate:modelValue":e[2]||(e[2]=l=>o(C).name=l),onKeyup:R(A,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(S,{title:"\u4FEE\u6539\u89D2\u8272",modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value=l),width:"50%",onClose:K},{footer:s(()=>[L("span",$e,[a(d,{onClick:K},{default:s(()=>[Ue]),_:1}),a(d,{onClick:D,type:"primary",loading:o(r).btn,disabled:o(r).edit},{default:s(()=>[Ne]),_:1},8,["loading","disabled"])])]),default:s(()=>[U((z(),N(I,{ref:"editFrom",model:o(_),"label-width":"80px",rules:o(B),onSubmit:e[6]||(e[6]=M(()=>{},["prevent"]))},{default:s(()=>[a(E,{label:"\u89D2\u8272",prop:"name"},{default:s(()=>[a(V,{modelValue:o(_).name,"onUpdate:modelValue":e[5]||(e[5]=l=>o(_).name=l),onKeyup:R(D,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),a(E,null,{default:s(()=>[a(Q,{data:o(m).list,"show-checkbox":"","node-key":"per_name","default-checked-keys":o(m).defaultCheckedkeys,props:o(m).treeProps,onCheck:W},null,8,["data","default-checked-keys","props"])]),_:1})]),_:1},8,["model","rules"])),[[$,o(r).edit]])]),_:1},8,["modelValue"])])}}};export{tt as default};
