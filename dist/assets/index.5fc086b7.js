import{j as x,i as Z,k as g,X as Q,Y as W,q as ee,F as te,Z as ae,$ as oe,a0 as se,a1 as le,G as ne,H as re,I as ie,a8 as de,J as ce,o as z,L as ue,a as t,w as s,u as o,a4 as me,K as R,c as D,N as c,O as pe,a5 as _e,a6 as fe,M as F,f as i,a7 as ge}from"./vendor.0ff88f1f.js";/* empty css                   */import{s as he}from"./functions.2b6d8712.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                           *//* empty css                      *//* empty css                  *//* empty css                  *//* empty css                  */const be={class:"roles"},ye=c("\u9996\u9875"),ke=c("\u89D2\u8272\u7BA1\u7406"),Ce=c("\u89D2\u8272\u5217\u8868"),ve=c("\u6DFB\u52A0\u89D2\u8272"),we=c("\u4FEE\u6539"),Ve=c("\u5220\u9664"),Ee={class:"dialog-footer"},xe=c("\u53D6 \u6D88"),ze=c("\u786E \u5B9A"),$e={class:"dialog-footer"},Be=c("\u53D6 \u6D88"),Ie=c("\u786E \u5B9A"),Ke={setup(Te){const w=x(!0),{proxy:m}=Z(),p=g({query:"",pagenum:1,pagesize:10}),r=g({edit:!1,btn:!1}),h=g({list:[],total:0,pagesizes:[5,10,15,20]}),_=async()=>{w.value=!0;const{data:a}=await m.$axios.get("/adminApi/roles",{params:p});if(a.meta.status!==200)return i.error(a.meta.msg);h.total=a.data.total,h.list=a.data.data,w.value=!1};_();const b=x(!1),q=()=>{b.value=!0},$=g({role_name:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",trigger:"blur"},{min:2,max:8,message:"\u957F\u5EA6\u5728 2 \u5230 8 \u4E2A\u5B57\u7B26",trigger:"blur"}]}),C=g({role_name:""}),U=()=>{m.$refs.addFrom.validate(async a=>{if(a){r.btn=!0;const{data:e}=await m.$axios.post("/adminApi/roles",C);if(e.meta.status!==200)return r.btn=!1,i.error(e.meta.msg);i.success(e.meta.msg),b.value=!1,r.btn=!1,_()}})},N=async a=>{ge.confirm("\u786E\u8BA4\u5220\u9664\u89D2\u8272\uFF1F","\u8B66\u544A",{distinguishCancelAndClose:!0,confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88"}).then(async()=>{i({dangerouslyUseHTMLString:!0,message:"\u6B63\u5728\u5220\u9664\u4E2D",type:"warning",duration:0});const{data:e}=await m.$axios.delete(`/adminApi/roles/${a}`);if(e.meta.status!==200)return i.error(e.meta.msg);i.closeAll(),i.success(e.meta.msg),_()}).catch(()=>{i.closeAll(),i.error("\u60A8\u53D6\u6D88\u4E86\u64CD\u4F5C")})},S=()=>{_()},L=a=>{p.pagesize=a,_()},M=a=>{p.pagenum=a,_()},y=x(!1),f=g({}),u=g({list:[],roleId:0,treeProps:{label:"per_name",children:"children"},defaultCheckedkeys:[]}),H=async a=>{y.value=!0,r.edit=!0,u.defaultCheckedkeys=[],u.roleId=a.id,f.role_name=a.role_name,f.per_ids=a.per_ids;const{data:e}=await m.$axios.get("/adminApi/rights");if(e.meta.status!==200)return i.error(e.meta.msg);u.list=e.data;const n=B(e.data,[]),k=a.per_ids?a.per_ids.split(","):[];u.defaultCheckedkeys=P(n,k),r.edit=!1},K=(a,e)=>{const n=[...e.checkedKeys,...e.halfCheckedKeys];f.per_ids=n.toString()},B=(a,e)=>(a.forEach(n=>{n.children?B(n.children,e):e.push(n.id)}),e),P=(a,e)=>{const n=[];return a.forEach(k=>{e.forEach(d=>{k===parseInt(d)&&n.push(d)})}),n},j=()=>{m.$refs.editFrom.validate(async a=>{if(a){r.btn=!0;const{data:e}=await m.$axios.put(`/adminApi/roles/${u.roleId}`,f);if(e.meta.status!==200)return r.btn=!1,i.error(e.meta.msg);i.success(e.meta.msg),_(),y.value=!1,r.btn=!1}})};return(a,e)=>{const n=Q,k=W,d=ee,V=te,v=ae,G=oe,J=se,O=le,E=ne,I=re,T=ie,X=de,A=ce;return z(),ue("div",be,[t(k,{"separator-class":"el-icon-arrow-right"},{default:s(()=>[t(n,{to:{name:"Home"}},{default:s(()=>[ye]),_:1}),t(n,null,{default:s(()=>[ke]),_:1}),t(n,null,{default:s(()=>[Ce]),_:1})]),_:1}),t(O,null,{default:s(()=>[t(V,{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",class:"input-with-select",modelValue:o(p).query,"onUpdate:modelValue":e[0]||(e[0]=l=>o(p).query=l)},{append:s(()=>[t(d,{icon:o(me),onClick:S},null,8,["icon"])]),_:1},8,["modelValue"]),t(d,{type:"primary",class:"add",onClick:q},{default:s(()=>[ve]),_:1}),R((z(),D(G,{data:o(h).list,border:"",style:{width:"100%"}},{default:s(()=>[t(v,{label:"#",type:"index"}),t(v,{prop:"role_name",label:"\u89D2\u8272"}),t(v,{prop:"created_at",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(l=>[c(pe(o(he)(l.row.created_at)),1)]),_:1}),t(v,{label:"\u64CD\u4F5C"},{default:s(l=>[t(d,{type:"primary",icon:o(_e),onClick:Y=>H(l.row),size:"small"},{default:s(()=>[we]),_:2},1032,["icon","onClick"]),t(d,{type:"danger",icon:o(fe),onClick:Y=>N(l.row.id),size:"small"},{default:s(()=>[Ve]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[A,w.value]]),t(J,{onSizeChange:L,onCurrentChange:M,"current-page":o(p).pagenum,"page-sizes":o(h).pagesizes,"page-size":o(p).pagesize,layout:"total, sizes, prev, pager, next, jumper",total:o(h).total},null,8,["current-page","page-sizes","page-size","total"])]),_:1}),t(T,{title:"\u6DFB\u52A0\u89D2\u8272",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),width:"30%"},{footer:s(()=>[F("span",Ee,[t(d,{onClick:e[2]||(e[2]=l=>b.value=!1)},{default:s(()=>[xe]),_:1}),t(d,{onClick:U,type:"primary",loading:o(r).btn},{default:s(()=>[ze]),_:1},8,["loading"])])]),default:s(()=>[t(I,{ref:"addFrom",model:o(C),"label-width":"80px",rules:o($)},{default:s(()=>[t(E,{label:"\u89D2\u8272",prop:"role_name"},{default:s(()=>[t(V,{modelValue:o(C).role_name,"onUpdate:modelValue":e[1]||(e[1]=l=>o(C).role_name=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(T,{title:"\u6DFB\u52A0\u89D2\u8272",modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=l=>y.value=l),width:"50%"},{footer:s(()=>[F("span",$e,[t(d,{onClick:e[5]||(e[5]=l=>y.value=!1)},{default:s(()=>[Be]),_:1}),t(d,{onClick:j,type:"primary",loading:o(r).btn,disabled:o(r).edit},{default:s(()=>[Ie]),_:1},8,["loading","disabled"])])]),default:s(()=>[R((z(),D(I,{ref:"editFrom",model:o(f),"label-width":"80px",rules:o($)},{default:s(()=>[t(E,{label:"\u89D2\u8272",prop:"role_name"},{default:s(()=>[t(V,{modelValue:o(f).role_name,"onUpdate:modelValue":e[4]||(e[4]=l=>o(f).role_name=l)},null,8,["modelValue"])]),_:1}),t(E,null,{default:s(()=>[t(X,{data:o(u).list,"show-checkbox":"","node-key":"id","default-checked-keys":o(u).defaultCheckedkeys,props:o(u).treeProps,onCheck:K},null,8,["data","default-checked-keys","props"])]),_:1})]),_:1},8,["model","rules"])),[[A,o(r).edit]])]),_:1},8,["modelValue"])])}}};export{Ke as default};
