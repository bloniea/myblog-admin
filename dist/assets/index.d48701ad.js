import{a as re,u as R,d as de,b as H,c as ne}from"./fetch.78d37eeb.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                   *//* empty css                           *//* empty css                  *//* empty css                       */import{i as B,j as w,X as ie,Y as ue,Z as pe,m as me,A as _e,_ as ce,$ as ge,a0 as fe,a1 as be,a2 as we,B as ye,a3 as Ve,a4 as ve,D as Ue,F as Ce,G as he,o as g,I as D,a as t,w as l,u as s,W as h,a5 as ke,H as $,c as k,K as u,L as j,a6 as Ee,a7 as xe,J as G,M as J,N as O,R as i,a8 as ze}from"./vendor.3ed8f5cd.js";import{s as Ke,e as Ae}from"./functions.4004cecb.js";import"./index.ff990c46.js";const Be={class:"users"},De=u("\u9996\u9875"),$e=u("\u7528\u6237\u7BA1\u7406"),Se=u("\u7528\u6237\u5217\u8868"),Te=u("\u6DFB\u52A0\u7528\u6237"),Fe=u("\u4FEE\u6539"),qe=u("\u5220\u9664"),Ie={class:"dialog-footer"},Le=u("\u53D6 \u6D88"),Me=u("\u786E \u5B9A"),Ne={class:"dialog-footer"},Re=u("\u53D6 \u6D88"),He=u("\u786E \u5B9A"),sa={setup(je){const x=B(!0),n=w({userData:[],total:0,pagesizes:[1,5,10,20],id:"",roles:""}),r=w({add:!1,edit:!1,btn:!1}),{proxy:V}=ie(),S=(o,e,p)=>{/^[a-z]+/i.test(e)?/[a-z0-9]+$/i.test(e)?p():p(new Error("\u7528\u6237\u540D\u53EA\u80FD\u5305\u542B\u82F1\u6587\u548C\u6570\u5B57")):p(new Error("\u7528\u6237\u540D\u5FC5\u987B\u82F1\u6587\u5F00\u5934"))},P=w({user:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},{min:3,max:16,message:"\u957F\u5EA6\u5728 3 \u5230 16 \u4E2A\u5B57\u7B26",trigger:"blur"},{validator:S,trigger:"blur"}],password:[{min:6,max:16,message:"\u957F\u5EA6\u57286 \u5230 16 \u4E2A\u5B57\u7B26",trigger:"blur"}],role_id:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272",trigger:"blur"}]}),W=w({user:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},{min:3,max:16,message:"\u957F\u5EA6\u5728 3 \u5230 16 \u4E2A\u5B57\u7B26",trigger:"blur"},{validator:S,trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"},{min:6,max:16,message:"\u957F\u5EA6\u57286 \u5230 16 \u4E2A\u5B57\u7B26",trigger:"blur"}],role_id:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272",trigger:"blur"}]}),f=w({keyword:"",pagesize:10,pagenum:1}),m=async()=>{x.value=!0;const o=await re(f);o.status===200&&o.ok&&(x.value=!1,n.userData=o.data.data,n.total=o.data.total)};m();const T=()=>{m()},X=async o=>{const e={role_id:o.role_id,user:o.user,status:o.status},p=await R(o._id,e);p.ok&&p.status===200?(i.success("\u4FEE\u6539\u6210\u529F"),m()):i.error(p.data.message)},Y=o=>{f.pagesize=o,m()},Z=o=>{f.pagenum=o,m()},Q=async o=>{ze.confirm("\u786E\u8BA4\u5220\u9664\u7528\u6237\uFF1F","\u8B66\u544A",{distinguishCancelAndClose:!0,confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88"}).then(async()=>{i({dangerouslyUseHTMLString:!0,message:"\u6B63\u5728\u5220\u9664\u4E2D",type:"warning",duration:0});const e=await de(o);e.ok&&e.status===200?(r.del=!1,i.closeAll(),i.success("\u5220\u9664\u6210\u529F"),m()):(i.closeAll(),i.error(e.data.message))}).catch(()=>{i.closeAll()})},v=B(!1),d=w({user:"",password:null,role_id:0,status:!0}),ee=async o=>{r.edit=!0;const e=await H();e.ok&&e.status===200&&(n.roles=e.data.data,r.edit=!1),v.value=!0,n.id=o._id,d.role_id=o.role_id,d.role_id=await Ae(d.role_id,n.roles)?o.role_id:"",d.user=o.user,d.status=o.status},z=()=>{V.$refs.editform.validate(async o=>{if(o){r.btn=!0;const e=await R(n.id,d);e.ok&&e.status===200?(V.$refs.editform.resetFields(),i.success("\u4FEE\u6539\u6210\u529F"),m(),r.btn=!1,v.value=!1):(r.btn=!1,i.error(e.data.message))}})},U=B(!1),_=w({user:"",password:"",role_id:""}),ae=async()=>{U.value=!0,r.add=!0;const o=await H();o.ok&&o.status===200&&(n.roles=o.data.data,r.add=!1)},K=()=>{V.$refs.addform.validate(async o=>{if(o){r.btn=!0;const e=await ne(_);e.ok&&e.status===200?(V.$refs.addform.resetFields(),i.success("\u6DFB\u52A0\u6210\u529F"),U.value=!1,r.btn=!1,m()):(r.btn=!1,i.error(e.data.message))}})},F=()=>{U.value=!1,V.$refs.addform.resetFields()};return(o,e)=>{const p=ue,te=pe,c=me,C=_e,y=ce,q=ge,se=fe,le=be,oe=we,b=ye,I=Ve,L=ve,M=Ue,N=Ce,A=he;return g(),D("div",Be,[t(te,{"separator-class":"el-icon-arrow-right"},{default:l(()=>[t(p,{to:{name:"Home"}},{default:l(()=>[De]),_:1}),t(p,null,{default:l(()=>[$e]),_:1}),t(p,null,{default:l(()=>[Se]),_:1})]),_:1}),t(oe,null,{default:l(()=>[t(C,{modelValue:s(f).keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>s(f).keyword=a),placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",class:"input-with-select",onKeyup:h(T,["enter"])},{append:l(()=>[t(c,{icon:s(ke),onClick:T},null,8,["icon"])]),_:1},8,["modelValue","onKeyup"]),t(c,{type:"primary",class:"add",onClick:ae},{default:l(()=>[Te]),_:1}),$((g(),k(se,{data:s(n).userData,border:"",style:{width:"100%"}},{default:l(()=>[t(y,{label:"#",type:"index"}),t(y,{prop:"user",label:"\u7528\u6237"}),t(y,{prop:"role_name",label:"\u89D2\u8272"},{default:l(a=>[u(j(a.row.role.length?a.row.role[0].name:"\u65E0"),1)]),_:1}),t(y,{prop:"status",label:"\u72B6\u6001"},{default:l(a=>[t(q,{modelValue:a.row.status,"onUpdate:modelValue":E=>a.row.status=E,onChange:E=>X(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(y,{prop:"created_at",label:"\u521B\u5EFA\u65F6\u95F4"},{default:l(a=>[u(j(s(Ke)(a.row.created_at)),1)]),_:1}),t(y,{label:"\u64CD\u4F5C"},{default:l(a=>[t(c,{type:"primary",icon:s(Ee),onClick:E=>ee(a.row),size:"small"},{default:l(()=>[Fe]),_:2},1032,["icon","onClick"]),t(c,{type:"danger",icon:s(xe),onClick:E=>Q(a.row._id),size:"small"},{default:l(()=>[qe]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[A,x.value]]),t(le,{onSizeChange:Y,onCurrentChange:Z,"current-page":s(f).pagenum,"page-sizes":s(n).pagesizes,"page-size":s(f).pagesize,layout:"total, sizes, prev, pager, next, jumper",total:s(n).total},null,8,["current-page","page-sizes","page-size","total"])]),_:1}),t(N,{title:"\u4FEE\u6539\u7528\u6237",modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value=a),width:"30%"},{footer:l(()=>[G("span",Ie,[t(c,{onClick:e[5]||(e[5]=a=>v.value=!1)},{default:l(()=>[Le]),_:1}),t(c,{type:"primary",onClick:z,loading:s(r).btn,disabled:s(r).edit},{default:l(()=>[Me]),_:1},8,["loading","disabled"])])]),default:l(()=>[$((g(),k(M,{ref:"editform",model:s(d),"label-width":"80px",rules:s(P)},{default:l(()=>[t(b,{label:"\u7528\u6237\u540D",prop:"user"},{default:l(()=>[t(C,{modelValue:s(d).user,"onUpdate:modelValue":e[1]||(e[1]=a=>s(d).user=a),onKeyup:h(z,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(b,{label:"\u5BC6\u7801",prop:"password"},{default:l(()=>[t(C,{modelValue:s(d).password,"onUpdate:modelValue":e[2]||(e[2]=a=>s(d).password=a),modelModifiers:{trim:!0},onKeyup:h(z,["enter"]),type:"password",placeholder:"******"},null,8,["modelValue","onKeyup"])]),_:1}),t(b,{label:"\u72B6\u6001"},{default:l(()=>[t(q,{modelValue:s(d).status,"onUpdate:modelValue":e[3]||(e[3]=a=>s(d).status=a)},null,8,["modelValue"])]),_:1}),t(b,{label:"\u89D2\u8272",prop:"role_id"},{default:l(()=>[t(L,{modelValue:s(d).role_id,"onUpdate:modelValue":e[4]||(e[4]=a=>s(d).role_id=a),placeholder:"\u8BF7\u9009\u62E9"},{default:l(()=>[(g(!0),D(J,null,O(s(n).roles,a=>(g(),k(I,{key:a._id,label:a.name,value:a._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[A,s(r).edit]])]),_:1},8,["modelValue"]),t(N,{title:"\u6DFB\u52A0\u7528\u6237",modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=a=>U.value=a),width:"30%",onClose:F},{footer:l(()=>[G("span",Ne,[t(c,{onClick:F},{default:l(()=>[Re]),_:1}),t(c,{type:"primary",onClick:K,loading:s(r).btn,disabled:s(r).add},{default:l(()=>[He]),_:1},8,["loading","disabled"])])]),default:l(()=>[$((g(),k(M,{ref:"addform",model:s(_),"label-width":"80px",rules:s(W)},{default:l(()=>[t(b,{label:"\u7528\u6237\u540D",prop:"user"},{default:l(()=>[t(C,{modelValue:s(_).user,"onUpdate:modelValue":e[7]||(e[7]=a=>s(_).user=a),onKeyup:h(K,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(b,{label:"\u5BC6\u7801",prop:"password"},{default:l(()=>[t(C,{modelValue:s(_).password,"onUpdate:modelValue":e[8]||(e[8]=a=>s(_).password=a),type:"password",onKeyup:h(K,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(b,{label:"\u89D2\u8272",prop:"role_id"},{default:l(()=>[t(L,{modelValue:s(_).role_id,"onUpdate:modelValue":e[9]||(e[9]=a=>s(_).role_id=a),placeholder:"\u8BF7\u9009\u62E9"},{default:l(()=>[(g(!0),D(J,null,O(s(n).roles,a=>(g(),k(I,{key:a._id,label:a.name,value:a._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[A,s(r).add]])]),_:1},8,["modelValue"])])}}};export{sa as default};
